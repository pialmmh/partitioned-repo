<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>MonitoringConfig.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">Generic Sharding-Aware Repository Framework</a> &gt; <a href="index.source.html" class="el_package">com.telcobright.core.monitoring</a> &gt; <span class="el_source">MonitoringConfig.java</span></div><h1>MonitoringConfig.java</h1><pre class="source lang-java linenums">package com.telcobright.core.monitoring;

import java.util.concurrent.TimeUnit;

/**
 * Configuration for repository monitoring system.
 * 
 * Supports multiple delivery methods:
 * - Prometheus HTTP endpoint
 * - REST API push
 * - Kafka push (future)
 * - SLF4J logging
 */
public class MonitoringConfig {
    
<span class="nc" id="L16">    public enum DeliveryMethod {</span>
<span class="nc" id="L17">        HTTP_ENDPOINT,    // Expose /metrics endpoint</span>
<span class="nc" id="L18">        REST_PUSH,        // Push to REST endpoint</span>
<span class="nc" id="L19">        KAFKA_PUSH,       // Push to Kafka (future)</span>
<span class="nc" id="L20">        SLF4J_LOGGING,    // Log metrics via SLF4J</span>
<span class="nc" id="L21">        CONSOLE_ONLY      // Console output only (for examples/testing)</span>
    }
    
<span class="nc" id="L24">    public enum MetricFormat {</span>
<span class="nc" id="L25">        PROMETHEUS,       // Prometheus format for HTTP endpoint</span>
<span class="nc" id="L26">        JSON,            // JSON format for REST push</span>
<span class="nc" id="L27">        FORMATTED_TEXT   // Human-readable text format for console</span>
    }
    
    private final boolean enabled;
    private final long reportingIntervalSeconds;
    private final DeliveryMethod deliveryMethod;
    private final MetricFormat metricFormat;
    private final String httpEndpointPath;
    private final String restPushUrl;
    private final String kafkaTopicName;
    private final String serviceName;
    private final String instanceId;
    private final boolean includeSystemMetrics;
    private final boolean includeConnectionPoolMetrics;
    private final boolean includeQueryMetrics;
    private final boolean enableSlowQueryLogging;
    private final long slowQueryThresholdMs;
    
<span class="nc" id="L45">    private MonitoringConfig(Builder builder) {</span>
<span class="nc" id="L46">        this.enabled = builder.enabled;</span>
<span class="nc" id="L47">        this.reportingIntervalSeconds = builder.reportingIntervalSeconds;</span>
<span class="nc" id="L48">        this.deliveryMethod = builder.deliveryMethod;</span>
<span class="nc" id="L49">        this.metricFormat = builder.metricFormat;</span>
<span class="nc" id="L50">        this.httpEndpointPath = builder.httpEndpointPath;</span>
<span class="nc" id="L51">        this.restPushUrl = builder.restPushUrl;</span>
<span class="nc" id="L52">        this.kafkaTopicName = builder.kafkaTopicName;</span>
<span class="nc" id="L53">        this.serviceName = builder.serviceName;</span>
<span class="nc" id="L54">        this.instanceId = builder.instanceId;</span>
<span class="nc" id="L55">        this.includeSystemMetrics = builder.includeSystemMetrics;</span>
<span class="nc" id="L56">        this.includeConnectionPoolMetrics = builder.includeConnectionPoolMetrics;</span>
<span class="nc" id="L57">        this.includeQueryMetrics = builder.includeQueryMetrics;</span>
<span class="nc" id="L58">        this.enableSlowQueryLogging = builder.enableSlowQueryLogging;</span>
<span class="nc" id="L59">        this.slowQueryThresholdMs = builder.slowQueryThresholdMs;</span>
<span class="nc" id="L60">    }</span>
    
    // Getters
<span class="nc" id="L63">    public boolean isEnabled() { return enabled; }</span>
<span class="nc" id="L64">    public long getReportingIntervalSeconds() { return reportingIntervalSeconds; }</span>
<span class="nc" id="L65">    public DeliveryMethod getDeliveryMethod() { return deliveryMethod; }</span>
<span class="nc" id="L66">    public MetricFormat getMetricFormat() { return metricFormat; }</span>
<span class="nc" id="L67">    public String getHttpEndpointPath() { return httpEndpointPath; }</span>
<span class="nc" id="L68">    public String getRestPushUrl() { return restPushUrl; }</span>
<span class="nc" id="L69">    public String getKafkaTopicName() { return kafkaTopicName; }</span>
<span class="nc" id="L70">    public String getServiceName() { return serviceName; }</span>
<span class="nc" id="L71">    public String getInstanceId() { return instanceId; }</span>
<span class="nc" id="L72">    public boolean isIncludeSystemMetrics() { return includeSystemMetrics; }</span>
<span class="nc" id="L73">    public boolean isIncludeConnectionPoolMetrics() { return includeConnectionPoolMetrics; }</span>
<span class="nc" id="L74">    public boolean isIncludeQueryMetrics() { return includeQueryMetrics; }</span>
<span class="nc" id="L75">    public boolean isEnableSlowQueryLogging() { return enableSlowQueryLogging; }</span>
<span class="nc" id="L76">    public long getSlowQueryThresholdMs() { return slowQueryThresholdMs; }</span>
    
    /**
     * Creates a disabled monitoring configuration
     */
    public static MonitoringConfig disabled() {
<span class="nc" id="L82">        return new Builder().enabled(false).build();</span>
    }
    
    /**
     * Creates a configuration for Prometheus HTTP endpoint
     */
    public static MonitoringConfig prometheusHttp(String endpointPath) {
<span class="nc" id="L89">        return new Builder()</span>
<span class="nc" id="L90">                .enabled(true)</span>
<span class="nc" id="L91">                .deliveryMethod(DeliveryMethod.HTTP_ENDPOINT)</span>
<span class="nc" id="L92">                .metricFormat(MetricFormat.PROMETHEUS)</span>
<span class="nc" id="L93">                .httpEndpointPath(endpointPath)</span>
<span class="nc" id="L94">                .build();</span>
    }
    
    /**
     * Creates a configuration for REST push
     */
    public static MonitoringConfig restPush(String pushUrl) {
<span class="nc" id="L101">        return new Builder()</span>
<span class="nc" id="L102">                .enabled(true)</span>
<span class="nc" id="L103">                .deliveryMethod(DeliveryMethod.REST_PUSH)</span>
<span class="nc" id="L104">                .metricFormat(MetricFormat.JSON)</span>
<span class="nc" id="L105">                .restPushUrl(pushUrl)</span>
<span class="nc" id="L106">                .build();</span>
    }
    
    /**
     * Creates a configuration for SLF4J logging
     */
    public static MonitoringConfig slf4jLogging() {
<span class="nc" id="L113">        return new Builder()</span>
<span class="nc" id="L114">                .enabled(true)</span>
<span class="nc" id="L115">                .deliveryMethod(DeliveryMethod.SLF4J_LOGGING)</span>
<span class="nc" id="L116">                .metricFormat(MetricFormat.JSON)</span>
<span class="nc" id="L117">                .build();</span>
    }
    
<span class="nc" id="L120">    public static class Builder {</span>
<span class="nc" id="L121">        private boolean enabled = true;</span>
<span class="nc" id="L122">        private long reportingIntervalSeconds = 60; // Default 1 minute</span>
<span class="nc" id="L123">        private DeliveryMethod deliveryMethod = DeliveryMethod.HTTP_ENDPOINT;</span>
<span class="nc" id="L124">        private MetricFormat metricFormat = MetricFormat.PROMETHEUS;</span>
<span class="nc" id="L125">        private String httpEndpointPath = &quot;/metrics&quot;;</span>
<span class="nc" id="L126">        private String restPushUrl = null;</span>
<span class="nc" id="L127">        private String kafkaTopicName = &quot;repository-metrics&quot;;</span>
<span class="nc" id="L128">        private String serviceName = &quot;partitioned-repo&quot;;</span>
<span class="nc" id="L129">        private String instanceId = getDefaultInstanceId();</span>
<span class="nc" id="L130">        private boolean includeSystemMetrics = false;</span>
<span class="nc" id="L131">        private boolean includeConnectionPoolMetrics = false;</span>
<span class="nc" id="L132">        private boolean includeQueryMetrics = false;</span>
<span class="nc" id="L133">        private boolean enableSlowQueryLogging = false;</span>
<span class="nc" id="L134">        private long slowQueryThresholdMs = 1000; // Default 1 second</span>
        
        public Builder enabled(boolean enabled) {
<span class="nc" id="L137">            this.enabled = enabled;</span>
<span class="nc" id="L138">            return this;</span>
        }
        
        public Builder reportingInterval(long interval, TimeUnit unit) {
<span class="nc" id="L142">            this.reportingIntervalSeconds = unit.toSeconds(interval);</span>
<span class="nc" id="L143">            return this;</span>
        }
        
        public Builder reportingIntervalSeconds(long seconds) {
<span class="nc" id="L147">            this.reportingIntervalSeconds = seconds;</span>
<span class="nc" id="L148">            return this;</span>
        }
        
        public Builder deliveryMethod(DeliveryMethod method) {
<span class="nc" id="L152">            this.deliveryMethod = method;</span>
<span class="nc" id="L153">            return this;</span>
        }
        
        public Builder metricFormat(MetricFormat format) {
<span class="nc" id="L157">            this.metricFormat = format;</span>
<span class="nc" id="L158">            return this;</span>
        }
        
        public Builder httpEndpointPath(String path) {
<span class="nc" id="L162">            this.httpEndpointPath = path;</span>
<span class="nc" id="L163">            return this;</span>
        }
        
        public Builder restPushUrl(String url) {
<span class="nc" id="L167">            this.restPushUrl = url;</span>
<span class="nc" id="L168">            return this;</span>
        }
        
        public Builder kafkaTopicName(String topicName) {
<span class="nc" id="L172">            this.kafkaTopicName = topicName;</span>
<span class="nc" id="L173">            return this;</span>
        }
        
        public Builder serviceName(String name) {
<span class="nc" id="L177">            this.serviceName = name;</span>
<span class="nc" id="L178">            return this;</span>
        }
        
        public Builder instanceId(String instanceId) {
<span class="nc" id="L182">            this.instanceId = instanceId;</span>
<span class="nc" id="L183">            return this;</span>
        }
        
        public Builder includeSystemMetrics(boolean include) {
<span class="nc" id="L187">            this.includeSystemMetrics = include;</span>
<span class="nc" id="L188">            return this;</span>
        }
        
        public Builder includeConnectionPoolMetrics(boolean include) {
<span class="nc" id="L192">            this.includeConnectionPoolMetrics = include;</span>
<span class="nc" id="L193">            return this;</span>
        }
        
        public Builder includeQueryMetrics(boolean include) {
<span class="nc" id="L197">            this.includeQueryMetrics = include;</span>
<span class="nc" id="L198">            return this;</span>
        }
        
        public Builder enableSlowQueryLogging(boolean enable) {
<span class="nc" id="L202">            this.enableSlowQueryLogging = enable;</span>
<span class="nc" id="L203">            return this;</span>
        }
        
        public Builder slowQueryThresholdMs(long thresholdMs) {
<span class="nc" id="L207">            this.slowQueryThresholdMs = thresholdMs;</span>
<span class="nc" id="L208">            return this;</span>
        }
        
        public MonitoringConfig build() {
<span class="nc" id="L212">            validate();</span>
<span class="nc" id="L213">            return new MonitoringConfig(this);</span>
        }
        
        private void validate() {
<span class="nc bnc" id="L217" title="All 2 branches missed.">            if (enabled) {</span>
<span class="nc bnc" id="L218" title="All 2 branches missed.">                if (reportingIntervalSeconds &lt;= 0) {</span>
<span class="nc" id="L219">                    throw new IllegalArgumentException(&quot;Reporting interval must be positive&quot;);</span>
                }
                
<span class="nc bnc" id="L222" title="All 4 branches missed.">                switch (deliveryMethod) {</span>
                    case REST_PUSH:
<span class="nc bnc" id="L224" title="All 4 branches missed.">                        if (restPushUrl == null || restPushUrl.trim().isEmpty()) {</span>
<span class="nc" id="L225">                            throw new IllegalArgumentException(&quot;REST push URL is required for REST_PUSH delivery method&quot;);</span>
                        }
                        break;
                    case HTTP_ENDPOINT:
<span class="nc bnc" id="L229" title="All 4 branches missed.">                        if (httpEndpointPath == null || httpEndpointPath.trim().isEmpty()) {</span>
<span class="nc" id="L230">                            throw new IllegalArgumentException(&quot;HTTP endpoint path is required for HTTP_ENDPOINT delivery method&quot;);</span>
                        }
                        break;
                    case KAFKA_PUSH:
<span class="nc bnc" id="L234" title="All 4 branches missed.">                        if (kafkaTopicName == null || kafkaTopicName.trim().isEmpty()) {</span>
<span class="nc" id="L235">                            throw new IllegalArgumentException(&quot;Kafka topic name is required for KAFKA_PUSH delivery method&quot;);</span>
                        }
                        break;
                }
                
<span class="nc bnc" id="L240" title="All 4 branches missed.">                if (serviceName == null || serviceName.trim().isEmpty()) {</span>
<span class="nc" id="L241">                    throw new IllegalArgumentException(&quot;Service name cannot be null or empty&quot;);</span>
                }
            }
<span class="nc" id="L244">        }</span>
        
        private static String getDefaultInstanceId() {
            try {
<span class="nc" id="L248">                return java.net.InetAddress.getLocalHost().getHostName();</span>
<span class="nc" id="L249">            } catch (Exception e) {</span>
<span class="nc" id="L250">                return &quot;unknown-&quot; + System.currentTimeMillis();</span>
            }
        }
    }
    
    @Override
    public String toString() {
<span class="nc" id="L257">        return String.format(</span>
            &quot;MonitoringConfig{enabled=%s, interval=%ds, delivery=%s, format=%s, service=%s, instance=%s}&quot;,
<span class="nc" id="L259">            enabled, reportingIntervalSeconds, deliveryMethod, metricFormat, serviceName, instanceId</span>
        );
    }
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.12.202403310830</span></div></body></html>