<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>FieldMetadata.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">Generic Sharding-Aware Repository Framework</a> &gt; <a href="index.source.html" class="el_package">com.telcobright.core.metadata</a> &gt; <span class="el_source">FieldMetadata.java</span></div><h1>FieldMetadata.java</h1><pre class="source lang-java linenums">package com.telcobright.core.metadata;

import com.telcobright.core.annotation.*;
import java.lang.reflect.Field;
import java.math.BigDecimal;
import java.time.LocalDateTime;

/**
 * Metadata for a single field in an entity
 */
public class FieldMetadata {
    private final Field field;
    private final String fieldName;
    private final String columnName;
    private final Class&lt;?&gt; type;
    private final boolean isId;
    private final boolean isAutoGenerated;
    private final boolean isShardingKey;
    private final boolean isNullable;
    private final boolean isInsertable;
    private final boolean isUpdatable;
    private final Index indexAnnotation;
    
<span class="fc" id="L24">    public FieldMetadata(Field field) {</span>
<span class="fc" id="L25">        this.field = field;</span>
<span class="fc" id="L26">        this.fieldName = field.getName();</span>
<span class="fc" id="L27">        this.type = field.getType();</span>
        
        // Parse annotations
<span class="fc" id="L30">        Column columnAnnotation = field.getAnnotation(Column.class);</span>
<span class="pc bpc" id="L31" title="2 of 4 branches missed.">        if (columnAnnotation != null &amp;&amp; !columnAnnotation.name().isEmpty()) {</span>
<span class="fc" id="L32">            this.columnName = columnAnnotation.name();</span>
        } else {
            // Convert camelCase to snake_case
<span class="nc" id="L35">            this.columnName = toSnakeCase(fieldName);</span>
        }
        
<span class="fc" id="L38">        Id idAnnotation = field.getAnnotation(Id.class);</span>
<span class="fc bfc" id="L39" title="All 2 branches covered.">        this.isId = idAnnotation != null;</span>
<span class="pc bpc" id="L40" title="2 of 6 branches missed.">        this.isAutoGenerated = isId &amp;&amp; (idAnnotation == null || idAnnotation.autoGenerated());</span>
        
<span class="fc bfc" id="L42" title="All 2 branches covered.">        this.isShardingKey = field.getAnnotation(ShardingKey.class) != null;</span>
<span class="fc" id="L43">        this.indexAnnotation = field.getAnnotation(Index.class);</span>
        
<span class="pc bpc" id="L45" title="1 of 2 branches missed.">        if (columnAnnotation != null) {</span>
<span class="fc" id="L46">            this.isNullable = columnAnnotation.nullable();</span>
<span class="fc" id="L47">            this.isInsertable = columnAnnotation.insertable();</span>
<span class="fc" id="L48">            this.isUpdatable = columnAnnotation.updatable();</span>
        } else {
<span class="nc" id="L50">            this.isNullable = true;</span>
<span class="nc" id="L51">            this.isInsertable = true;</span>
<span class="nc" id="L52">            this.isUpdatable = true;</span>
        }
<span class="fc" id="L54">    }</span>
    
    private String toSnakeCase(String camelCase) {
<span class="nc" id="L57">        return camelCase.replaceAll(&quot;([a-z])([A-Z])&quot;, &quot;$1_$2&quot;).toLowerCase();</span>
    }
    
    public Object getValue(Object entity) {
        try {
<span class="nc" id="L62">            return field.get(entity);</span>
<span class="nc" id="L63">        } catch (IllegalAccessException e) {</span>
<span class="nc" id="L64">            throw new RuntimeException(&quot;Failed to get field value: &quot; + fieldName, e);</span>
        }
    }
    
    public void setValue(Object entity, Object value) {
        try {
<span class="nc" id="L70">            field.set(entity, value);</span>
<span class="nc" id="L71">        } catch (IllegalAccessException e) {</span>
<span class="nc" id="L72">            throw new RuntimeException(&quot;Failed to set field value: &quot; + fieldName, e);</span>
<span class="nc" id="L73">        }</span>
<span class="nc" id="L74">    }</span>
    
    public String getSqlType() {
<span class="fc bfc" id="L77" title="All 2 branches covered.">        if (type == String.class) {</span>
<span class="pc bpc" id="L78" title="1 of 4 branches missed.">            if (fieldName.equals(&quot;message&quot;) || fieldName.equals(&quot;shippingAddress&quot;)) {</span>
<span class="fc" id="L79">                return &quot;TEXT&quot;;</span>
            }
<span class="fc" id="L81">            return &quot;VARCHAR(255)&quot;;</span>
<span class="pc bpc" id="L82" title="2 of 4 branches missed.">        } else if (type == Long.class || type == long.class) {</span>
<span class="nc" id="L83">            return &quot;BIGINT&quot;;</span>
<span class="pc bpc" id="L84" title="2 of 4 branches missed.">        } else if (type == Integer.class || type == int.class) {</span>
<span class="nc" id="L85">            return &quot;INT&quot;;</span>
<span class="fc bfc" id="L86" title="All 2 branches covered.">        } else if (type == LocalDateTime.class) {</span>
<span class="fc" id="L87">            return &quot;DATETIME&quot;;</span>
<span class="pc bpc" id="L88" title="1 of 2 branches missed.">        } else if (type == BigDecimal.class) {</span>
<span class="fc" id="L89">            return &quot;DECIMAL(10,2)&quot;;</span>
<span class="nc bnc" id="L90" title="All 4 branches missed.">        } else if (type == Boolean.class || type == boolean.class) {</span>
<span class="nc" id="L91">            return &quot;BOOLEAN&quot;;</span>
<span class="nc bnc" id="L92" title="All 4 branches missed.">        } else if (type == Double.class || type == double.class) {</span>
<span class="nc" id="L93">            return &quot;DOUBLE&quot;;</span>
        } else {
<span class="nc" id="L95">            return &quot;VARCHAR(255)&quot;;</span>
        }
    }
    
    // Getters
<span class="fc" id="L100">    public String getFieldName() { return fieldName; }</span>
<span class="fc" id="L101">    public String getColumnName() { return columnName; }</span>
<span class="fc" id="L102">    public Class&lt;?&gt; getType() { return type; }</span>
<span class="fc" id="L103">    public boolean isId() { return isId; }</span>
<span class="fc" id="L104">    public boolean isAutoGenerated() { return isAutoGenerated; }</span>
<span class="fc" id="L105">    public boolean isShardingKey() { return isShardingKey; }</span>
<span class="fc" id="L106">    public boolean isNullable() { return isNullable; }</span>
<span class="fc" id="L107">    public boolean isInsertable() { return isInsertable; }</span>
<span class="fc" id="L108">    public boolean isUpdatable() { return isUpdatable; }</span>
    
    /**
     * Check if this field has an @Index annotation
     */
<span class="pc bpc" id="L113" title="1 of 2 branches missed.">    public boolean hasIndex() { return indexAnnotation != null; }</span>
    
    /**
     * Get the @Index annotation if present
     */
<span class="nc" id="L118">    public Index getIndexAnnotation() { return indexAnnotation; }</span>
    
    /**
     * Get the index name, either custom or auto-generated
     */
    public String getIndexName() {
<span class="nc bnc" id="L124" title="All 2 branches missed.">        if (indexAnnotation == null) return null;</span>
        
<span class="nc" id="L126">        String customName = indexAnnotation.name();</span>
<span class="nc bnc" id="L127" title="All 2 branches missed.">        if (!customName.isEmpty()) {</span>
<span class="nc" id="L128">            return customName;</span>
        }
        
        // Auto-generate index name: idx_{column_name}
<span class="nc" id="L132">        return &quot;idx_&quot; + columnName;</span>
    }
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.12.202403310830</span></div></body></html>